CISCO.ui.captcha=(function(){function a(i,n){var l=CISCO.ui.build,o=CISCO.ui.captchaStrings,k="IMAGE",d=null,c={},f=true;c.elContainer=$(i);if(c.elContainer.length==0){return{hasCaptcha:false,getCaptcha:function(){}}}c.captchaResponse=l.INPUT({type:"text"});c.getNew=l.A({title:o.getNewWords,"class":"refresh-captcha-button"});if(n){c.toggleType=l.A({title:o.button_audio,"class":"captcha-audio-button"})}c.captchaImage=l.IMG({"class":"captcha-image",src:webroot + "ui/static/images/ping.png"});c.audioCaptcha=l.A({innerHTML:o.listenLink,"class":"captcha-audio"});var j=[c.captchaImage,c.audioCaptcha,l.DIV({"class":"captcha-controls-container"},[l.DIV({"class":"captcha-input-container"},[l.P(o.typeWords),l.P(c.captchaResponse)]),l.DIV({"class":"captcha-controls"},[c.getNew,c.toggleType])])];j.forEach(function(b){c.elContainer.append(b)});$(c.getNew).click(e);if(n){$(c.toggleType).click(g)}c.elCaptchaResponse=$(c.captchaResponse);if(c.elContainer.is(":visible")){e()}function m(){return c.elCaptchaResponse.val()}function g(){var b=k.toLowerCase();$(c.toggleType).attr("class","captcha-"+b+"-button").attr("title",o["button_"+b]);k=(k=="IMAGE"?"AUDIO":"IMAGE");e()}function e(){CLOUD.send({url:webroot + "cloud/captcha-service/rest/captchas",type:"POST",data:{captcha:{type:k}},cb:function(b){if(b.errors){CISCO.ui.alert(b.errors.error.message)}else{d=b.captcha.challengeToken;var p=true;switch(k){case"IMAGE":$(c.captchaImage).attr("src",b.captcha.resourceUrl);break;case"AUDIO":p=false;$(c.audioCaptcha).attr("href",b.captcha.resourceUrl);break}$(c.captchaImage).css("display",p?"block":"none");$(c.audioCaptcha).css("display",!p?"block":"none");h()}},cbError:function(p){try{var b=JSON.parse(p.responseText);CISCO.ui.alert(b.errors[0].error.message)}catch(q){CISCO.ui.dialog("#generic-error",{isError:true}).show()}}})}function h(){c.elCaptchaResponse.val("")}return{getToken:function(){return d},elements:c,getCaptcha:e,clear:h,show:function(){c.elContainer.show()},getResponse:m,hasCaptcha:f}}return{init:a}}());